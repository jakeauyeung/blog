---
layout: post
title:  "CENTOS6.0安装配置nginx"
date:   2013-07-11 22:00:58
categories: update
---

nginx的安装，我选择了直接编译，系统centos632位，于是去nginx找了个版本来安装（这里提一下：我刚开始选择了开发版本，最后编译出错，这段我快被折磨疯掉了，尼玛，后面才发现选错了版本，于是换了稳定版本目前我的版本号：<a href="http://nginx.org/download/nginx-1.2.6.tar.gz" target="_blank">nginx-1.2.6</a> T——T）。

下载nginx:
{% highlight bash %}
wget http://nginx.org/download/nginx-1.2.6.tar.gz 
{% endhighlight %}
解压出来：
{% highlight bash %}
tar zxvf nginx-1.2.6.tar.gz 
{% endhighlight %}
进入目录：
{% highlight bash %}
cd nginx-1.2.6
{% endhighlight %}
在编译之前需要安装一些依赖包，我给统一找出来了。

{% highlight bash %}
yum -y install gcc gcc-c++ autoconf automake zlib zlib-devel openssl openssl--devel pcre pcre-devel
{% endhighlight %}

编译：
{% highlight bash %}
./configure
make
make install 
{% endhighlight %}
nginx默认安装的目录是/usr/local/nginx，对应的配置文件在conf目录下。
另：nginx默认是没有被添加在service中的，可将以下脚本添加到/etc/init.d目录里面，文件名字我取的是nginx。

{% highlight bash %}
#!/bin/sh 
# 
# nginx - this script starts and stops the nginx daemon 
# 
# chkconfig:   - 85 15 
# description: Nginx is an HTTP(S) server, HTTP(S) reverse \ 
#               proxy and IMAP/POP3 proxy server 
# processname: nginx 
# config:      /etc/nginx/nginx.conf 
# config:      /etc/sysconfig/nginx 
# pidfile:     /var/run/nginx.pid 

# Source function library. 
. /etc/rc.d/init.d/functions

# Source networking configuration. 
. /etc/sysconfig/network 

# Check that networking is up. 

[ "$NETWORKING" = "no" ] && exit 0 

nginx="/usr/local/nginx/sbin/nginx" 
prog=$(basename $nginx) 
NGINX_CONF_FILE="/usr/local/nginx/conf/nginx.conf" 
[ -f /etc/sysconfig/nginx ] && . /etc/sysconfig/nginx 
lockfile=/var/lock/subsys/nginx 

start() { 
    [ -x $nginx ] || exit 5 
    [ -f $NGINX_CONF_FILE ] || exit 6 
    echo -n $"Starting $prog: " 
    daemon $nginx -c $NGINX_CONF_FILE 
    retval=$? 
    echo 
    [ $retval -eq 0 ] && touch $lockfile 
    return $retval 
} 

stop() { 
    echo -n $"Stopping $prog: " 
    killproc $prog -QUIT 
    retval=$? 
    echo 
    [ $retval -eq 0 ] && rm -f $lockfile 
    return $retval 
killall -9 nginx 
} 

restart() { 
    configtest || return $? 
    stop 
    sleep 1 
    start 
} 

reload() { 
    configtest || return $? 
    echo -n $"Reloading $prog: " 
    killproc $nginx -HUP 
RETVAL=$? 
    echo 
} 

force_reload() { 
    restart 
} 

configtest() { 
$nginx -t -c $NGINX_CONF_FILE 
} 

rh_status() { 
    status $prog 
} 

rh_status_q() { 
    rh_status >/dev/null 2>&1 
} 

case "$1" in 
    start) 
        rh_status_q && exit 0 
    $1 
        ;; 
    stop) 
        rh_status_q || exit 0 
        $1 
        ;; 
    restart|configtest) 
        $1 
        ;; 
    reload) 
        rh_status_q || exit 7 
        $1 
        ;; 
    force-reload) 
        force_reload 
        ;; 
    status) 
        rh_status 
        ;; 
    condrestart|try-restart) 
        rh_status_q || exit 0 
            ;; 
    *)    
      echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}" 
        exit 2 
esac
{% endhighlight %}

然后添加到系统：
{% highlight bash %}
chkconfig --add nginx 
{% endhighlight %}
系统自动启动：
{% highlight bash %}
chkconfig nginx  on 
{% endhighlight %}
启动nginx：
{% highlight bash %}
service nginx start 
{% endhighlight %}
提示：
{% highlight bash %}
env: /etc/init.d/nginx: Permission denied 
{% endhighlight %}
执行：
{% highlight bash %}
sudo chmod 775 nginx
{% endhighlight %}
再次启动就没有问题了。enjoy！！！
